# 一个网络抽风问题以及一个网络闪断问题

## 网络抽风问题

前段时间将家里的 AP 换成了  UniFi UAP-AC-LITE，给它搭配了一个 ER-X 作为交换机，这个交换机支持 POE passthrough，但只有在它自己插在 24v 1A 电源下才会主动进行 POE 输出。就是这个 POE passthrough 导致了抽风的问题。

与该问题相关的家里的拓扑如下：

```
光猫---RB450g-----ER-X------UAP-AC-Lite  
        |           |  
 UbntController   IPTV盒子
```

过年回来，看 IPTV 发现动不动就画面卡住，持续时间几秒到几分钟不等，显示网络连接有问题。开始怀疑是不是电信自己的视频服务器出了问题，于是利用 Ubnt 的 App 测试了 wifi 的连通性（实际上测试的是手机经 AP 然后流转到 Controller 的速度），发现 wifi 速度很慢，很艰难才能爬上 30Mbps，而且电视卡住时 wifi 的数据包也传输不了，这样就可以肯定是内部网络问题了。之前测试过 RB450g 上面连接的设备，速度并没有问题，那么出问题概率比较大的就是 ER-X 和网线了。网线之前一直没有问题，直接 AP 跳过 ER-X 直连网线测试速度也不存在问题，很轻松彪到 200+ Mbps。ER-X 是新买的，嫌疑最大，但之前安装完之后也做了一下连通测试，也没发现什么问题啊。

这时我灵光一闪，想到 ER-X 实际上是支持 9v 到 24v 供电的，但不同的电源对它有不同的影响（比如开不了 POE）。一开始装上去测试的时候我是连接了它附带的电源，并没有使用它的 POE，后来又购入 UAP-AC-Lite，附送了一个 POE 供电器，出于减少电源插口的需要，我就用这个 POE 供电器给 ER-X 供电，然后再 passthrough 给 UAP-AC-Lite，这样操作后两个设备都能跑起来，平时看起来也是正常工作的。是不是因为这样之后，存在 ER-X 供电不足的情况呢？

找出 ER-X 的电源插上去，关掉它的 POE passthrough，让 POE 供电模块直接给 AP 上电，结果网络居然美妙的正常了。真是活久见，之前供电不足设备都完全没法用，很容易就能够发现问题，现在供电不足，设备只是在负荷大的时候抽风，真是太具有迷惑性了。

## 网络闪断问题

还是上面那个网络拓扑，搞掂上面那个抽风问题后，看电视还是不省心，很偶尔会出现一次画面卡住，显示网络连接有问题的情况（实际上我很少看电视，这几天家里来了客人整天看才发现了这个问题）。检查了 RB450g 上面的 log，发现它到 ER-X 的链路就在那个卡住的时候 down 一下，然后几秒钟后就又自动 up 了，表现就是网络闪断了几秒钟。

RB450g 也用了好几年了，虽然一直表现都挺好的，是不是因为老化出现了问题？但其他端口上面的链路都没有问题啊。将连到 ER-X 的网线从网口 3 调到网口 5，好嘛，现在网口 5 又开始闪断了。google 下，网上很多 RouterOS 闪断的资料，很多就是 Mikrotik 自家论坛上面的帖子，最后都找不到解决方案，大家的猜测有“RouterOS 跟 Ubnt 设备不太兼容”、“板载网口存在问题”、“需要关闭端口的 Loop protect”等等。但将 ER-X 换成 TP-link，关掉了 Loop Protect，问题还是存在。而且之前网口5 没有问题的，将线接过去之后，它也闪断了，看样子不太像单纯的硬件的问题。看着琳琅满目的闪断帖子控诉，莫非我要换一个华硕的路由器了？我陷入了深深的沉思。

这时候，看水木的 digihome 版，正好[有人上去声讨扁平网线](https://www.newsmth.net/nForum/#!article/DigiHome/848036)，而且它的姐妹帖子[请问扁平网线是不是很烂啊](https://www.newsmth.net/nForum/#!article/DigiHome/848634)里面也有资深用户表示扁平网线长了之后，经常导致传输出问题然后网络速度协商出问题，从千兆掉到百兆。正好看 RB450g 的日志，发现这条链路 down 了之后再起来，有时候协商到的速度是 100M 而不是应该是的 1G，所以网线出问题的概率就突然变大了。理论上扁平网线不是双绞结构，从而抗干扰能力不强，再加上我家里的这根网线有 15 米长，的确可能出现这种问题，虽然它是声称自己是六类线的成品网线。

研究了下，从淘宝买了根 15 米的日线的细径跳线来试试，它的口碑不错。昨天到货之后，用它替换了原来的扁平网线，然后开着电视盒子一直放高清信号，一直到现在，还没有出现过链路 down 的问题，现在基本上可以确定是扁平网线不堪大用了。他娘的还好意思说自己是六类线！

